{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\nimport type { Database } from './database.types'\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createServerClient<Database>(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return cookieStore.getAll()\r\n        },\r\n        setAll(cookiesToSet) {\r\n          try {\r\n            cookiesToSet.forEach(({ name, value, options }) =>\r\n              cookieStore.set(name, value, options)\r\n            )\r\n          } catch {\r\n            // The `setAll` method was called from a Server Component.\r\n            // This can be ignored if you have middleware refreshing\r\n            // user sessions.\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,yQAAO;IAEjC,OAAO,IAAA,sSAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 35, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/app/actions/create-user-record.ts"],"sourcesContent":["'use server'\r\n\r\nimport { createClient } from '@/lib/supabase/server'\r\n\r\n/**\r\n * Server action to create user record after signup\r\n * Uses the system function via RPC which bypasses RLS\r\n * This is a reliable backup in case the trigger doesn't fire immediately\r\n */\r\nexport async function createUserRecord(userId: string, userData: {\r\n  email: string\r\n  role: 'smme' | 'admin'\r\n  firstName: string\r\n  lastName: string\r\n  phone: string\r\n}) {\r\n  try {\r\n    const supabase = await createClient()\r\n\r\n    // Check if user record already exists\r\n    const { data: existingUser } = await supabase\r\n      .from('users')\r\n      .select('id')\r\n      .eq('id', userId)\r\n      .maybeSingle()\r\n\r\n    if (existingUser) {\r\n      return {\r\n        success: true,\r\n        message: 'User record already exists',\r\n        data: existingUser,\r\n      }\r\n    }\r\n\r\n    // Use the system function via RPC (bypasses RLS)\r\n    // This function uses SECURITY DEFINER and doesn't require auth check\r\n    const { data, error } = await (supabase as any).rpc('create_user_record_system', {\r\n      user_id: userId,\r\n      user_email: userData.email,\r\n      user_role: userData.role,\r\n      user_first_name: userData.firstName,\r\n      user_last_name: userData.lastName,\r\n      user_phone: userData.phone,\r\n    })\r\n\r\n    if (error) {\r\n      // If duplicate key error, record exists (race condition - trigger created it)\r\n      if (error.code === '23505') {\r\n        return {\r\n          success: true,\r\n          message: 'User record already exists (created by trigger)',\r\n        }\r\n      }\r\n\r\n      console.error('Failed to create user record via RPC:', {\r\n        code: error.code,\r\n        message: error.message,\r\n        details: error.details,\r\n      })\r\n\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to create user record',\r\n      }\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      message: 'User record created successfully',\r\n      data: { id: data || userId },\r\n    }\r\n  } catch (error: any) {\r\n    console.error('Error in createUserRecord:', error)\r\n    return {\r\n      success: false,\r\n      error: error.message || 'Failed to create user record',\r\n    }\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;;;;AAOO,eAAe,iBAAiB,MAAc,EAAE,QAMtD;IACC,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,yIAAY;QAEnC,sCAAsC;QACtC,MAAM,EAAE,MAAM,YAAY,EAAE,GAAG,MAAM,SAClC,IAAI,CAAC,SACL,MAAM,CAAC,MACP,EAAE,CAAC,MAAM,QACT,WAAW;QAEd,IAAI,cAAc;YAChB,OAAO;gBACL,SAAS;gBACT,SAAS;gBACT,MAAM;YACR;QACF;QAEA,iDAAiD;QACjD,qEAAqE;QACrE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,AAAC,SAAiB,GAAG,CAAC,6BAA6B;YAC/E,SAAS;YACT,YAAY,SAAS,KAAK;YAC1B,WAAW,SAAS,IAAI;YACxB,iBAAiB,SAAS,SAAS;YACnC,gBAAgB,SAAS,QAAQ;YACjC,YAAY,SAAS,KAAK;QAC5B;QAEA,IAAI,OAAO;YACT,8EAA8E;YAC9E,IAAI,MAAM,IAAI,KAAK,SAAS;gBAC1B,OAAO;oBACL,SAAS;oBACT,SAAS;gBACX;YACF;YAEA,QAAQ,KAAK,CAAC,yCAAyC;gBACrD,MAAM,MAAM,IAAI;gBAChB,SAAS,MAAM,OAAO;gBACtB,SAAS,MAAM,OAAO;YACxB;YAEA,OAAO;gBACL,SAAS;gBACT,OAAO,MAAM,OAAO,IAAI;YAC1B;QACF;QAEA,OAAO;YACL,SAAS;YACT,SAAS;YACT,MAAM;gBAAE,IAAI,QAAQ;YAAO;QAC7B;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;YACL,SAAS;YACT,OAAO,MAAM,OAAO,IAAI;QAC1B;IACF;AACF;;;IArEsB;;AAAA,8WAAA"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/.next-internal/server/app/pending-approval/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {createUserRecord as '60b59951fd5143ab30439d8982ae3ae4d3d966f67f'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}