{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/lib/supabase/auth-helpers.ts"],"sourcesContent":["import { createClient } from './server'\r\nimport { redirect } from 'next/navigation'\r\nimport type { AuthUser } from '@/lib/auth'\r\n\r\nexport async function getServerSession(): Promise<AuthUser | null> {\r\n  const supabase = await createClient()\r\n  \r\n  // Try getSession first - this reads from cookies\r\n  const { data: { session }, error: sessionError } = await supabase.auth.getSession()\r\n  \r\n  if (sessionError) {\r\n    console.error('[getServerSession] Session error:', {\r\n      message: sessionError.message,\r\n      status: sessionError.status,\r\n    })\r\n  }\r\n  \r\n  // If we have a session, use it\r\n  if (session?.user) {\r\n    console.log('[getServerSession] Session found via getSession()')\r\n    const { data: profile, error: profileError } = await supabase\r\n      .from('users')\r\n      .select('id, email, role, first_name, last_name, approved')\r\n      .eq('id', session.user.id)\r\n      .maybeSingle()\r\n\r\n    if (profileError) {\r\n      console.error('[getServerSession] Profile query error:', profileError)\r\n      return null\r\n    }\r\n\r\n    if (!profile) {\r\n      console.warn('[getServerSession] Profile not found for user:', session.user.id)\r\n      return null\r\n    }\r\n\r\n    return {\r\n      id: profile.id,\r\n      email: profile.email,\r\n      role: profile.role,\r\n      name: `${profile.first_name} ${profile.last_name}`,\r\n      approved: profile.approved,\r\n    }\r\n  }\r\n  \r\n  // Fallback: try getUser() which might work if session is in headers\r\n  console.warn('[getServerSession] No session from getSession(), trying getUser()...')\r\n  const { data: { user }, error } = await supabase.auth.getUser()\r\n  \r\n  if (error) {\r\n    console.error('[getServerSession] getUser() error:', {\r\n      message: error.message,\r\n      status: error.status,\r\n    })\r\n    return null\r\n  }\r\n  \r\n  if (!user) {\r\n    console.warn('[getServerSession] No user found')\r\n    return null\r\n  }\r\n  \r\n  console.log('[getServerSession] User found via getUser()')\r\n\r\n  const { data: profile, error: profileError } = await supabase\r\n    .from('users')\r\n    .select('id, email, role, first_name, last_name, approved')\r\n    .eq('id', user.id)\r\n    .maybeSingle()\r\n\r\n  if (profileError) {\r\n    console.error('Profile query error:', profileError)\r\n    return null\r\n  }\r\n\r\n  if (!profile) {\r\n    console.warn('Profile not found for user:', user.id)\r\n    return null\r\n  }\r\n\r\n  return {\r\n    id: profile.id,\r\n    email: profile.email,\r\n    role: profile.role,\r\n    name: `${profile.first_name} ${profile.last_name}`,\r\n    approved: profile.approved,\r\n  }\r\n}\r\n\r\nexport async function requireAuth(): Promise<AuthUser> {\r\n  const session = await getServerSession()\r\n  \r\n  if (!session) {\r\n    redirect('/login')\r\n  }\r\n  \r\n  return session\r\n}\r\n\r\nexport async function requireAdmin(): Promise<AuthUser> {\r\n  const session = await getServerSession()\r\n  \r\n  if (!session) {\r\n    redirect('/login')\r\n  }\r\n  \r\n  if (session.role !== 'admin') {\r\n    redirect('/dashboard')\r\n  }\r\n  \r\n  return session\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AAAA;;;AAGO,eAAe;IACpB,MAAM,WAAW,MAAM,IAAA,yIAAY;IAEnC,iDAAiD;IACjD,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;IAEjF,IAAI,cAAc;QAChB,QAAQ,KAAK,CAAC,qCAAqC;YACjD,SAAS,aAAa,OAAO;YAC7B,QAAQ,aAAa,MAAM;QAC7B;IACF;IAEA,+BAA+B;IAC/B,IAAI,SAAS,MAAM;QACjB,QAAQ,GAAG,CAAC;QACZ,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAClD,IAAI,CAAC,SACL,MAAM,CAAC,oDACP,EAAE,CAAC,MAAM,QAAQ,IAAI,CAAC,EAAE,EACxB,WAAW;QAEd,IAAI,cAAc;YAChB,QAAQ,KAAK,CAAC,2CAA2C;YACzD,OAAO;QACT;QAEA,IAAI,CAAC,SAAS;YACZ,QAAQ,IAAI,CAAC,kDAAkD,QAAQ,IAAI,CAAC,EAAE;YAC9E,OAAO;QACT;QAEA,OAAO;YACL,IAAI,QAAQ,EAAE;YACd,OAAO,QAAQ,KAAK;YACpB,MAAM,QAAQ,IAAI;YAClB,MAAM,GAAG,QAAQ,UAAU,CAAC,CAAC,EAAE,QAAQ,SAAS,EAAE;YAClD,UAAU,QAAQ,QAAQ;QAC5B;IACF;IAEA,oEAAoE;IACpE,QAAQ,IAAI,CAAC;IACb,MAAM,EAAE,MAAM,EAAE,IAAI,EAAE,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE7D,IAAI,OAAO;QACT,QAAQ,KAAK,CAAC,uCAAuC;YACnD,SAAS,MAAM,OAAO;YACtB,QAAQ,MAAM,MAAM;QACtB;QACA,OAAO;IACT;IAEA,IAAI,CAAC,MAAM;QACT,QAAQ,IAAI,CAAC;QACb,OAAO;IACT;IAEA,QAAQ,GAAG,CAAC;IAEZ,MAAM,EAAE,MAAM,OAAO,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,SAClD,IAAI,CAAC,SACL,MAAM,CAAC,oDACP,EAAE,CAAC,MAAM,KAAK,EAAE,EAChB,WAAW;IAEd,IAAI,cAAc;QAChB,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO;IACT;IAEA,IAAI,CAAC,SAAS;QACZ,QAAQ,IAAI,CAAC,+BAA+B,KAAK,EAAE;QACnD,OAAO;IACT;IAEA,OAAO;QACL,IAAI,QAAQ,EAAE;QACd,OAAO,QAAQ,KAAK;QACpB,MAAM,QAAQ,IAAI;QAClB,MAAM,GAAG,QAAQ,UAAU,CAAC,CAAC,EAAE,QAAQ,SAAS,EAAE;QAClD,UAAU,QAAQ,QAAQ;IAC5B;AACF;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM;IAEtB,IAAI,CAAC,SAAS;QACZ,IAAA,gUAAQ,EAAC;IACX;IAEA,OAAO;AACT;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM;IAEtB,IAAI,CAAC,SAAS;QACZ,IAAA,gUAAQ,EAAC;IACX;IAEA,IAAI,QAAQ,IAAI,KAAK,SAAS;QAC5B,IAAA,gUAAQ,EAAC;IACX;IAEA,OAAO;AACT"}},
    {"offset": {"line": 110, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/app/dashboard/dashboard-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/dashboard/dashboard-client.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/dashboard/dashboard-client.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,uYAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAsS,GACnU,oEACA","ignoreList":[0]}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/app/dashboard/dashboard-client.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/dashboard/dashboard-client.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/dashboard/dashboard-client.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,uYAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAkR,GAC/S,gDACA","ignoreList":[0]}},
    {"offset": {"line": 138, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 146, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/app/dashboard/page.tsx"],"sourcesContent":["import { redirect } from 'next/navigation'\r\nimport { getServerSession } from '@/lib/supabase/auth-helpers'\r\nimport DashboardClient from './dashboard-client'\r\n\r\nexport default async function DashboardPage() {\r\n  const session = await getServerSession()\r\n  \r\n  if (!session) {\r\n    redirect('/login')\r\n  }\r\n  \r\n  if (session.role === 'admin') {\r\n    redirect('/admin')\r\n  }\r\n  \r\n  if (!session.approved) {\r\n    redirect('/pending-approval')\r\n  }\r\n\r\n  return <DashboardClient user={session} />\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AAAA;AACA;AACA;;;;;AAEe,eAAe;IAC5B,MAAM,UAAU,MAAM,IAAA,sJAAgB;IAEtC,IAAI,CAAC,SAAS;QACZ,IAAA,gUAAQ,EAAC;IACX;IAEA,IAAI,QAAQ,IAAI,KAAK,SAAS;QAC5B,IAAA,gUAAQ,EAAC;IACX;IAEA,IAAI,CAAC,QAAQ,QAAQ,EAAE;QACrB,IAAA,gUAAQ,EAAC;IACX;IAEA,qBAAO,6WAAC,mJAAe;QAAC,MAAM;;;;;;AAChC"}}]
}