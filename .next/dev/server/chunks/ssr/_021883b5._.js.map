{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 11, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/app/actions/create-user-record.ts"],"sourcesContent":["'use server'\n\nimport { createClient } from '@/lib/supabase/server'\n\n/**\n * Server action to create user record after signup\n * Uses the system function via RPC which bypasses RLS\n * This is a reliable backup in case the trigger doesn't fire immediately\n */\nexport async function createUserRecord(userId: string, userData: {\n  email: string\n  role: 'smme' | 'admin'\n  firstName: string\n  lastName: string\n  phone: string\n}) {\n  try {\n    const supabase = await createClient()\n\n    // Check if user record already exists\n    const { data: existingUser } = await supabase\n      .from('users')\n      .select('id')\n      .eq('id', userId)\n      .maybeSingle()\n\n    if (existingUser) {\n      return {\n        success: true,\n        message: 'User record already exists',\n        data: existingUser,\n      }\n    }\n\n    // Use the system function via RPC (bypasses RLS)\n    // This function uses SECURITY DEFINER and doesn't require auth check\n    const { data, error } = await (supabase as any).rpc('create_user_record_system', {\n      user_id: userId,\n      user_email: userData.email,\n      user_role: userData.role,\n      user_first_name: userData.firstName,\n      user_last_name: userData.lastName,\n      user_phone: userData.phone,\n    })\n\n    if (error) {\n      // If duplicate key error, record exists (race condition - trigger created it)\n      if (error.code === '23505') {\n        return {\n          success: true,\n          message: 'User record already exists (created by trigger)',\n        }\n      }\n\n      console.error('Failed to create user record via RPC:', {\n        code: error.code,\n        message: error.message,\n        details: error.details,\n      })\n\n      return {\n        success: false,\n        error: error.message || 'Failed to create user record',\n      }\n    }\n\n    return {\n      success: true,\n      message: 'User record created successfully',\n      data: { id: data || userId },\n    }\n  } catch (error: any) {\n    console.error('Error in createUserRecord:', error)\n    return {\n      success: false,\n      error: error.message || 'Failed to create user record',\n    }\n  }\n}\n\n"],"names":[],"mappings":";;;;;;;IASsB,mBAAA,WAAA,GAAA,IAAA,8WAAA,EAAA,8CAAA,mWAAA,EAAA,KAAA,GAAA,yWAAA,EAAA"}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/node_modules/.pnpm/next%4016.0.3_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// eslint-disable-next-line import/no-extraneous-dependencies\nexport { createServerReference } from 'react-server-dom-webpack/client'\n"],"names":["callServer","createServerReference","findSourceMapURL"],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;;;;;;;;;;;;;;;;IAEjBA,UAAU,EAAA;eAAVA,eAAAA,UAAU;;IAMVC,qBAAqB,EAAA;eAArBA,QAAAA,qBAAqB;;IALrBC,gBAAgB,EAAA;eAAhBA,qBAAAA,gBAAgB;;;+BADE;qCACM;wBAKK","ignoreList":[0]}}]
}