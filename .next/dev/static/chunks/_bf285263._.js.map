{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/app/actions/create-user-record.ts"],"sourcesContent":["'use server'\r\n\r\nimport { createClient } from '@/lib/supabase/server'\r\n\r\n/**\r\n * Server action to create user record after signup\r\n * Uses the system function via RPC which bypasses RLS\r\n * This is a reliable backup in case the trigger doesn't fire immediately\r\n */\r\nexport async function createUserRecord(userId: string, userData: {\r\n  email: string\r\n  role: 'smme' | 'admin'\r\n  firstName: string\r\n  lastName: string\r\n  phone: string\r\n}) {\r\n  try {\r\n    const supabase = await createClient()\r\n\r\n    // Check if user record already exists\r\n    const { data: existingUser } = await supabase\r\n      .from('users')\r\n      .select('id')\r\n      .eq('id', userId)\r\n      .maybeSingle()\r\n\r\n    if (existingUser) {\r\n      return {\r\n        success: true,\r\n        message: 'User record already exists',\r\n        data: existingUser,\r\n      }\r\n    }\r\n\r\n    // Use the system function via RPC (bypasses RLS)\r\n    // This function uses SECURITY DEFINER and doesn't require auth check\r\n    const { data, error } = await (supabase as any).rpc('create_user_record_system', {\r\n      user_id: userId,\r\n      user_email: userData.email,\r\n      user_role: userData.role,\r\n      user_first_name: userData.firstName,\r\n      user_last_name: userData.lastName,\r\n      user_phone: userData.phone,\r\n    })\r\n\r\n    if (error) {\r\n      // If duplicate key error, record exists (race condition - trigger created it)\r\n      if (error.code === '23505') {\r\n        return {\r\n          success: true,\r\n          message: 'User record already exists (created by trigger)',\r\n        }\r\n      }\r\n\r\n      console.error('Failed to create user record via RPC:', {\r\n        code: error.code,\r\n        message: error.message,\r\n        details: error.details,\r\n      })\r\n\r\n      return {\r\n        success: false,\r\n        error: error.message || 'Failed to create user record',\r\n      }\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      message: 'User record created successfully',\r\n      data: { id: data || userId },\r\n    }\r\n  } catch (error: any) {\r\n    console.error('Error in createUserRecord:', error)\r\n    return {\r\n      success: false,\r\n      error: error.message || 'Failed to create user record',\r\n    }\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;;IASsB,mBAAA,WAAA,GAAA,IAAA,iXAAA,EAAA,8CAAA,sWAAA,EAAA,KAAA,GAAA,4WAAA,EAAA"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/node_modules/.pnpm/next%4016.0.3_react-dom%4019.2.0_react%4019.2.0__react%4019.2.0/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// eslint-disable-next-line import/no-extraneous-dependencies\nexport { createServerReference } from 'react-server-dom-webpack/client'\n"],"names":["callServer","createServerReference","findSourceMapURL"],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;;;;;;;;;;;;;;;;IAEjBA,UAAU,EAAA;eAAVA,eAAAA,UAAU;;IAMVC,qBAAqB,EAAA;eAArBA,QAAAA,qBAAqB;;IALrBC,gBAAgB,EAAA;eAAhBA,qBAAAA,gBAAgB;;;+BADE;qCACM;wBAKK","ignoreList":[0]}}]
}