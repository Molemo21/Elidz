{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\nimport type { Database } from './database.types'\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createServerClient<Database>(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return cookieStore.getAll()\r\n        },\r\n        setAll(cookiesToSet) {\r\n          try {\r\n            cookiesToSet.forEach(({ name, value, options }) =>\r\n              cookieStore.set(name, value, options)\r\n            )\r\n          } catch {\r\n            // The `setAll` method was called from a Server Component.\r\n            // This can be ignored if you have middleware refreshing\r\n            // user sessions.\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,2QAAO;IAEjC,OAAO,IAAA,wSAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 77, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/lib/db/queries.ts"],"sourcesContent":["// Reusable query helpers with consistent error handling\r\n// These provide a standardized way to interact with the database\r\n\r\nimport { createClient } from '@/lib/supabase/server'\r\nimport type { Database } from '@/lib/supabase/database.types'\r\n\r\n/**\r\n * Generic result type for all queries\r\n */\r\nexport type QueryResult<T> = {\r\n  success: boolean\r\n  data?: T\r\n  error?: string\r\n  code?: string\r\n}\r\n\r\n/**\r\n * Generic error handler for Supabase errors\r\n * Maps common error codes to user-friendly messages\r\n */\r\nfunction handleSupabaseError<T>(error: any): QueryResult<T> {\r\n  // Unique constraint violation (duplicate key)\r\n  if (error?.code === '23505') {\r\n    return { success: false, error: 'Record already exists', code: 'DUPLICATE' }\r\n  }\r\n  \r\n  // Foreign key violation\r\n  if (error?.code === '23503') {\r\n    return { success: false, error: 'Referenced record does not exist', code: 'FOREIGN_KEY' }\r\n  }\r\n  \r\n  // Not found\r\n  if (error?.code === 'PGRST116') {\r\n    return { success: false, error: 'Record not found', code: 'NOT_FOUND' }\r\n  }\r\n  \r\n  // Permission denied (RLS)\r\n  if (error?.code === '42501' || error?.message?.includes('permission denied')) {\r\n    return { success: false, error: 'Permission denied', code: 'PERMISSION_DENIED' }\r\n  }\r\n  \r\n  // Generic error\r\n  return { \r\n    success: false, \r\n    error: error?.message || 'Database operation failed',\r\n    code: error?.code \r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// USER PROFILE QUERIES\r\n// ============================================================================\r\n\r\nexport const userProfileQueries = {\r\n  /**\r\n   * Get user profile by user ID\r\n   */\r\n  async getByUserId(\r\n    userId: string\r\n  ): Promise<QueryResult<Database['public']['Tables']['user_profiles']['Row']>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('user_profiles')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .maybeSingle()\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      if (!data) return { success: false, error: 'Profile not found', code: 'NOT_FOUND' }\r\n      \r\n      return { success: true, data }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Upsert user profile (create or update)\r\n   */\r\n  async upsert(\r\n    userId: string,\r\n    profile: Database['public']['Tables']['user_profiles']['Insert']\r\n  ): Promise<QueryResult<Database['public']['Tables']['user_profiles']['Row']>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('user_profiles')\r\n        .upsert(\r\n          { ...profile, user_id: userId },\r\n          { onConflict: 'user_id' }\r\n        )\r\n        .select()\r\n        .single()\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      return { success: true, data: data! }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update user profile (partial update)\r\n   */\r\n  async update(\r\n    userId: string,\r\n    updates: Database['public']['Tables']['user_profiles']['Update']\r\n  ): Promise<QueryResult<Database['public']['Tables']['user_profiles']['Row']>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('user_profiles')\r\n        .update(updates)\r\n        .eq('user_id', userId)\r\n        .select()\r\n        .single()\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      if (!data) return { success: false, error: 'Profile not found', code: 'NOT_FOUND' }\r\n      \r\n      return { success: true, data }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if profile is complete (has all required onboarding data)\r\n   */\r\n  async isComplete(userId: string): Promise<boolean> {\r\n    try {\r\n      const result = await this.getByUserId(userId)\r\n      if (!result.success || !result.data) return false\r\n\r\n      const profile = result.data\r\n      \r\n      // Check required fields\r\n      const required = [\r\n        profile.company_name,\r\n        profile.registration_number,\r\n        profile.industry,\r\n        profile.business_description,\r\n        profile.location,\r\n        profile.annual_revenue,\r\n        profile.employees_count,\r\n        profile.years_in_business,\r\n        profile.funding_requirements\r\n      ]\r\n\r\n      if (required.some(field => field === null || field === undefined || field === '')) {\r\n        return false\r\n      }\r\n\r\n      // Validate funding_requirements structure\r\n      const fundingReqs = profile.funding_requirements as any\r\n      if (!fundingReqs?.amount_needed || !fundingReqs?.funding_purpose) {\r\n        return false\r\n      }\r\n\r\n      return true\r\n    } catch {\r\n      return false\r\n    }\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// USER QUERIES\r\n// ============================================================================\r\n\r\nexport const userQueries = {\r\n  /**\r\n   * Get all users (admin only - caller must verify admin status)\r\n   */\r\n  async getAll(): Promise<QueryResult<Database['public']['Tables']['users']['Row'][]>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('users')\r\n        .select('*')\r\n        .order('created_at', { ascending: false })\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      return { success: true, data: data || [] }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get user by ID\r\n   */\r\n  async getById(\r\n    userId: string\r\n  ): Promise<QueryResult<Database['public']['Tables']['users']['Row']>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('users')\r\n        .select('*')\r\n        .eq('id', userId)\r\n        .maybeSingle()\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      if (!data) return { success: false, error: 'User not found', code: 'NOT_FOUND' }\r\n      \r\n      return { success: true, data }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get user by email\r\n   */\r\n  async getByEmail(\r\n    email: string\r\n  ): Promise<QueryResult<Database['public']['Tables']['users']['Row']>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('users')\r\n        .select('*')\r\n        .eq('email', email)\r\n        .maybeSingle()\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      if (!data) return { success: false, error: 'User not found', code: 'NOT_FOUND' }\r\n      \r\n      return { success: true, data }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update user approval status\r\n   */\r\n  async updateApproval(\r\n    userId: string,\r\n    approved: boolean\r\n  ): Promise<QueryResult<Database['public']['Tables']['users']['Row']>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('users')\r\n        .update({ approved })\r\n        .eq('id', userId)\r\n        .select()\r\n        .single()\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      if (!data) return { success: false, error: 'User not found', code: 'NOT_FOUND' }\r\n      \r\n      return { success: true, data }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update user last login timestamp\r\n   */\r\n  async updateLastLogin(userId: string): Promise<QueryResult<Database['public']['Tables']['users']['Row']>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('users')\r\n        .update({ last_login: new Date().toISOString() })\r\n        .eq('id', userId)\r\n        .select()\r\n        .single()\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      return { success: true, data: data! }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// FUNDING OPPORTUNITY QUERIES\r\n// ============================================================================\r\n\r\nexport const opportunityQueries = {\r\n  /**\r\n   * Get all opportunities\r\n   */\r\n  async getAll(): Promise<QueryResult<Database['public']['Tables']['funding_opportunities']['Row'][]>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('funding_opportunities')\r\n        .select('*')\r\n        .order('created_at', { ascending: false })\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      return { success: true, data: data || [] }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get opportunity by ID\r\n   */\r\n  async getById(\r\n    opportunityId: string\r\n  ): Promise<QueryResult<Database['public']['Tables']['funding_opportunities']['Row']>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('funding_opportunities')\r\n        .select('*')\r\n        .eq('id', opportunityId)\r\n        .maybeSingle()\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      if (!data) return { success: false, error: 'Opportunity not found', code: 'NOT_FOUND' }\r\n      \r\n      return { success: true, data }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get opportunities by industry\r\n   */\r\n  async getByIndustry(\r\n    industry: string\r\n  ): Promise<QueryResult<Database['public']['Tables']['funding_opportunities']['Row'][]>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('funding_opportunities')\r\n        .select('*')\r\n        .contains('industry_focus', [industry])\r\n        .order('created_at', { ascending: false })\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      return { success: true, data: data || [] }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get active opportunities (deadline in future)\r\n   */\r\n  async getActive(): Promise<QueryResult<Database['public']['Tables']['funding_opportunities']['Row'][]>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const now = new Date().toISOString()\r\n      const { data, error } = await supabase\r\n        .from('funding_opportunities')\r\n        .select('*')\r\n        .gt('deadline', now)\r\n        .order('deadline', { ascending: true })\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      return { success: true, data: data || [] }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// MATCH QUERIES\r\n// ============================================================================\r\n\r\nexport const matchQueries = {\r\n  /**\r\n   * Get matches for user\r\n   */\r\n  async getByUserId(\r\n    userId: string\r\n  ): Promise<QueryResult<Database['public']['Tables']['matches']['Row'][]>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('matches')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .order('match_score', { ascending: false })\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      return { success: true, data: data || [] }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update match status\r\n   */\r\n  async updateStatus(\r\n    matchId: string,\r\n    status: Database['public']['Tables']['matches']['Row']['status']\r\n  ): Promise<QueryResult<Database['public']['Tables']['matches']['Row']>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const updateData: any = { status }\r\n      if (status === 'viewed') {\r\n        updateData.viewed_at = new Date().toISOString()\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from('matches')\r\n        .update(updateData)\r\n        .eq('id', matchId)\r\n        .select()\r\n        .single()\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      if (!data) return { success: false, error: 'Match not found', code: 'NOT_FOUND' }\r\n      \r\n      return { success: true, data }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// APPLICATION QUERIES\r\n// ============================================================================\r\n\r\nexport const applicationQueries = {\r\n  /**\r\n   * Get applications for user\r\n   */\r\n  async getByUserId(\r\n    userId: string\r\n  ): Promise<QueryResult<Database['public']['Tables']['applications']['Row'][]>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('applications')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .order('created_at', { ascending: false })\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      return { success: true, data: data || [] }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get application by ID\r\n   */\r\n  async getById(\r\n    applicationId: string\r\n  ): Promise<QueryResult<Database['public']['Tables']['applications']['Row']>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const { data, error } = await supabase\r\n        .from('applications')\r\n        .select('*')\r\n        .eq('id', applicationId)\r\n        .maybeSingle()\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      if (!data) return { success: false, error: 'Application not found', code: 'NOT_FOUND' }\r\n      \r\n      return { success: true, data }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update application status\r\n   */\r\n  async updateStatus(\r\n    applicationId: string,\r\n    status: Database['public']['Tables']['applications']['Row']['status']\r\n  ): Promise<QueryResult<Database['public']['Tables']['applications']['Row']>> {\r\n    try {\r\n      const supabase = await createClient()\r\n      const updateData: any = { status }\r\n      \r\n      if (status === 'submitted') {\r\n        updateData.submitted_at = new Date().toISOString()\r\n      } else if (status === 'approved' || status === 'rejected') {\r\n        updateData.reviewed_at = new Date().toISOString()\r\n      }\r\n\r\n      const { data, error } = await supabase\r\n        .from('applications')\r\n        .update(updateData)\r\n        .eq('id', applicationId)\r\n        .select()\r\n        .single()\r\n\r\n      if (error) return handleSupabaseError(error)\r\n      if (!data) return { success: false, error: 'Application not found', code: 'NOT_FOUND' }\r\n      \r\n      return { success: true, data }\r\n    } catch (error: any) {\r\n      return handleSupabaseError(error)\r\n    }\r\n  }\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 526, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/lib/prisma.ts"],"sourcesContent":["// Prisma Client singleton\r\n// Use this instead of creating new PrismaClient instances\r\n\r\nimport { PrismaClient } from '@prisma/client'\r\n\r\nconst globalForPrisma = globalThis as unknown as {\r\n  prisma: PrismaClient | undefined\r\n}\r\n\r\n// Verify DATABASE_URL is set\r\nif (!process.env.DATABASE_URL) {\r\n  throw new Error(\r\n    'DATABASE_URL environment variable is not set. Please check your .env.local file and ensure it contains DATABASE_URL.'\r\n  )\r\n}\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ??\r\n  new PrismaClient({\r\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\r\n  })\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n\r\n"],"names":[],"mappings":"AAAA,0BAA0B;AAC1B,0DAA0D;;;;;AAE1D;;AAEA,MAAM,kBAAkB;AAIxB,6BAA6B;AAC7B,IAAI,CAAC,QAAQ,GAAG,CAAC,YAAY,EAAE;IAC7B,MAAM,IAAI,MACR;AAEJ;AAEO,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IACf,KAAK,uCAAyC;QAAC;QAAS;QAAS;KAAO,GAAG;AAC7E;AAEF,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 551, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/lib/db/queries-prisma.ts"],"sourcesContent":["// Prisma Query Helpers - Production Ready\r\n// Migrated from Supabase queries with best practices\r\n// \r\n// Key improvements:\r\n// - Full type safety with Prisma generated types\r\n// - Consistent error handling\r\n// - Better performance with optimized queries\r\n// - Clearer, more maintainable code\r\n\r\nimport { prisma } from '@/lib/prisma'\r\nimport type { Prisma } from '@prisma/client'\r\n\r\n/**\r\n * Generic result type for all queries (matches Supabase pattern)\r\n */\r\nexport type QueryResult<T> = {\r\n  success: boolean\r\n  data?: T\r\n  error?: string\r\n  code?: string\r\n}\r\n\r\n/**\r\n * Prisma error handler - maps Prisma errors to consistent format\r\n */\r\nfunction handlePrismaError<T>(error: any): QueryResult<T> {\r\n  // Record not found (P2025)\r\n  if (error?.code === 'P2025') {\r\n    return { success: false, error: 'Record not found', code: 'NOT_FOUND' }\r\n  }\r\n  \r\n  // Unique constraint violation (P2002)\r\n  if (error?.code === 'P2002') {\r\n    const field = error.meta?.target?.[0] || 'field'\r\n    return { \r\n      success: false, \r\n      error: `Record with this ${field} already exists`, \r\n      code: 'DUPLICATE' \r\n    }\r\n  }\r\n  \r\n  // Foreign key constraint violation (P2003)\r\n  if (error?.code === 'P2003') {\r\n    return { \r\n      success: false, \r\n      error: 'Referenced record does not exist', \r\n      code: 'FOREIGN_KEY' \r\n    }\r\n  }\r\n  \r\n  // Generic error\r\n  return {\r\n    success: false,\r\n    error: error?.message || 'Database operation failed',\r\n    code: error?.code,\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// USER PROFILE QUERIES\r\n// ============================================================================\r\n\r\nexport const userProfileQueries = {\r\n  /**\r\n   * Get user profile by user ID\r\n   */\r\n  async getByUserId(\r\n    userId: string\r\n  ): Promise<QueryResult<Prisma.UserProfileGetPayload<{}>>> {\r\n    try {\r\n      const profile = await prisma.userProfile.findUnique({\r\n        where: { userId },\r\n      })\r\n\r\n      if (!profile) {\r\n        return { success: false, error: 'Profile not found', code: 'NOT_FOUND' }\r\n      }\r\n\r\n      return { success: true, data: profile }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Upsert user profile (create or update)\r\n   */\r\n  async upsert(\r\n    userId: string,\r\n    profile: any // Accept any for flexibility, will be validated by caller\r\n  ): Promise<QueryResult<Prisma.UserProfileGetPayload<{}>>> {\r\n    try {\r\n      const result = await prisma.userProfile.upsert({\r\n        where: { userId },\r\n        update: profile as Prisma.UserProfileUpdateInput,\r\n        create: {\r\n          userId,\r\n          ...profile,\r\n        } as Prisma.UserProfileCreateInput,\r\n      })\r\n\r\n      return { success: true, data: result }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update user profile (partial update)\r\n   */\r\n  async update(\r\n    userId: string,\r\n    updates: Prisma.UserProfileUpdateInput\r\n  ): Promise<QueryResult<Prisma.UserProfileGetPayload<{}>>> {\r\n    try {\r\n      const profile = await prisma.userProfile.update({\r\n        where: { userId },\r\n        data: updates,\r\n      })\r\n\r\n      return { success: true, data: profile }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Check if profile is complete (has all required onboarding data)\r\n   */\r\n  async isComplete(userId: string): Promise<boolean> {\r\n    try {\r\n      const result = await this.getByUserId(userId)\r\n      if (!result.success || !result.data) return false\r\n\r\n      const profile = result.data\r\n\r\n      // Check required fields\r\n      const required = [\r\n        profile.companyName,\r\n        profile.registrationNumber,\r\n        profile.industry,\r\n        profile.businessDescription,\r\n        profile.location,\r\n        profile.annualRevenue,\r\n        profile.employeesCount,\r\n        profile.yearsInBusiness,\r\n        profile.fundingRequirements,\r\n      ]\r\n\r\n      if (required.some(field => field === null || field === undefined || field === '')) {\r\n        return false\r\n      }\r\n\r\n      // Validate funding_requirements structure\r\n      const fundingReqs = profile.fundingRequirements as any\r\n      if (!fundingReqs?.amount_needed || !fundingReqs?.funding_purpose) {\r\n        return false\r\n      }\r\n\r\n      return true\r\n    } catch {\r\n      return false\r\n    }\r\n  },\r\n}\r\n\r\n// ============================================================================\r\n// USER QUERIES\r\n// ============================================================================\r\n\r\nexport const userQueries = {\r\n  /**\r\n   * Get all users (admin only - caller must verify admin status)\r\n   */\r\n  async getAll(): Promise<QueryResult<Prisma.UserGetPayload<{}>[]>> {\r\n    try {\r\n      const users = await prisma.user.findMany({\r\n        orderBy: {\r\n          createdAt: 'desc',\r\n        },\r\n      })\r\n\r\n      return { success: true, data: users }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get user by ID\r\n   */\r\n  async getById(\r\n    userId: string\r\n  ): Promise<QueryResult<Prisma.UserGetPayload<{}>>> {\r\n    try {\r\n      const user = await prisma.user.findUnique({\r\n        where: { id: userId },\r\n      })\r\n\r\n      if (!user) {\r\n        return { success: false, error: 'User not found', code: 'NOT_FOUND' }\r\n      }\r\n\r\n      return { success: true, data: user }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get user by email\r\n   */\r\n  async getByEmail(\r\n    email: string\r\n  ): Promise<QueryResult<Prisma.UserGetPayload<{}>>> {\r\n    try {\r\n      const user = await prisma.user.findUnique({\r\n        where: { email },\r\n      })\r\n\r\n      if (!user) {\r\n        return { success: false, error: 'User not found', code: 'NOT_FOUND' }\r\n      }\r\n\r\n      return { success: true, data: user }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update user approval status\r\n   */\r\n  async updateApproval(\r\n    userId: string,\r\n    approved: boolean\r\n  ): Promise<QueryResult<Prisma.UserGetPayload<{}>>> {\r\n    try {\r\n      const user = await prisma.user.update({\r\n        where: { id: userId },\r\n        data: { approved },\r\n      })\r\n\r\n      return { success: true, data: user }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update user last login timestamp\r\n   */\r\n  async updateLastLogin(\r\n    userId: string\r\n  ): Promise<QueryResult<Prisma.UserGetPayload<{}>>> {\r\n    try {\r\n      const user = await prisma.user.update({\r\n        where: { id: userId },\r\n        data: { lastLogin: new Date() },\r\n      })\r\n\r\n      return { success: true, data: user }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n}\r\n\r\n// ============================================================================\r\n// FUNDING OPPORTUNITY QUERIES\r\n// ============================================================================\r\n\r\nexport const opportunityQueries = {\r\n  /**\r\n   * Get all opportunities\r\n   */\r\n  async getAll(): Promise<QueryResult<Prisma.FundingOpportunityGetPayload<{}>[]>> {\r\n    try {\r\n      const opportunities = await prisma.fundingOpportunity.findMany({\r\n        orderBy: {\r\n          createdAt: 'desc',\r\n        },\r\n      })\r\n\r\n      return { success: true, data: opportunities }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get opportunity by ID\r\n   */\r\n  async getById(\r\n    opportunityId: string\r\n  ): Promise<QueryResult<Prisma.FundingOpportunityGetPayload<{}>>> {\r\n    try {\r\n      const opportunity = await prisma.fundingOpportunity.findUnique({\r\n        where: { id: opportunityId },\r\n      })\r\n\r\n      if (!opportunity) {\r\n        return {\r\n          success: false,\r\n          error: 'Opportunity not found',\r\n          code: 'NOT_FOUND',\r\n        }\r\n      }\r\n\r\n      return { success: true, data: opportunity }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get opportunities by industry\r\n   */\r\n  async getByIndustry(\r\n    industry: string\r\n  ): Promise<QueryResult<Prisma.FundingOpportunityGetPayload<{}>[]>> {\r\n    try {\r\n      const opportunities = await prisma.fundingOpportunity.findMany({\r\n        where: {\r\n          industryFocus: {\r\n            has: industry, // Array contains\r\n          },\r\n        },\r\n        orderBy: {\r\n          createdAt: 'desc',\r\n        },\r\n      })\r\n\r\n      return { success: true, data: opportunities }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get active opportunities (deadline in future)\r\n   */\r\n  async getActive(): Promise<QueryResult<Prisma.FundingOpportunityGetPayload<{}>[]>> {\r\n    try {\r\n      const now = new Date()\r\n      const opportunities = await prisma.fundingOpportunity.findMany({\r\n        where: {\r\n          deadline: {\r\n            gt: now,\r\n          },\r\n        },\r\n        orderBy: {\r\n          deadline: 'asc',\r\n        },\r\n      })\r\n\r\n      return { success: true, data: opportunities }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n}\r\n\r\n// ============================================================================\r\n// MATCH QUERIES\r\n// ============================================================================\r\n\r\nexport const matchQueries = {\r\n  /**\r\n   * Get matches for user\r\n   */\r\n  async getByUserId(\r\n    userId: string\r\n  ): Promise<QueryResult<Prisma.MatchGetPayload<{}>[]>> {\r\n    try {\r\n      const matches = await prisma.match.findMany({\r\n        where: { userId },\r\n        orderBy: {\r\n          matchScore: 'desc',\r\n        },\r\n      })\r\n\r\n      return { success: true, data: matches }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update match status\r\n   */\r\n  async updateStatus(\r\n    matchId: string,\r\n    status: string // 'new' | 'viewed' | 'interested' | 'applied'\r\n  ): Promise<QueryResult<Prisma.MatchGetPayload<{}>>> {\r\n    try {\r\n      const updateData: Prisma.MatchUpdateInput = { status }\r\n      \r\n      // Set viewed_at when status becomes 'viewed'\r\n      if (status === 'viewed') {\r\n        updateData.viewedAt = new Date()\r\n      }\r\n\r\n      const match = await prisma.match.update({\r\n        where: { id: matchId },\r\n        data: updateData,\r\n      })\r\n\r\n      return { success: true, data: match }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n}\r\n\r\n// ============================================================================\r\n// APPLICATION QUERIES\r\n// ============================================================================\r\n\r\nexport const applicationQueries = {\r\n  /**\r\n   * Get applications for user\r\n   */\r\n  async getByUserId(\r\n    userId: string\r\n  ): Promise<QueryResult<Prisma.ApplicationGetPayload<{}>[]>> {\r\n    try {\r\n      const applications = await prisma.application.findMany({\r\n        where: { userId },\r\n        orderBy: {\r\n          createdAt: 'desc',\r\n        },\r\n      })\r\n\r\n      return { success: true, data: applications }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Get application by ID\r\n   */\r\n  async getById(\r\n    applicationId: string\r\n  ): Promise<QueryResult<Prisma.ApplicationGetPayload<{}>>> {\r\n    try {\r\n      const application = await prisma.application.findUnique({\r\n        where: { id: applicationId },\r\n      })\r\n\r\n      if (!application) {\r\n        return {\r\n          success: false,\r\n          error: 'Application not found',\r\n          code: 'NOT_FOUND',\r\n        }\r\n      }\r\n\r\n      return { success: true, data: application }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Update application status\r\n   */\r\n  async updateStatus(\r\n    applicationId: string,\r\n    status: string // 'draft' | 'in_review' | 'submitted' | 'approved' | 'rejected'\r\n  ): Promise<QueryResult<Prisma.ApplicationGetPayload<{}>>> {\r\n    try {\r\n      const updateData: Prisma.ApplicationUpdateInput = { status }\r\n\r\n      if (status === 'submitted') {\r\n        updateData.submittedAt = new Date()\r\n      } else if (status === 'approved' || status === 'rejected') {\r\n        updateData.reviewedAt = new Date()\r\n      }\r\n\r\n      const application = await prisma.application.update({\r\n        where: { id: applicationId },\r\n        data: updateData,\r\n      })\r\n\r\n      return { success: true, data: application }\r\n    } catch (error: any) {\r\n      return handlePrismaError(error)\r\n    }\r\n  },\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1027, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/lib/db/test-queries-comparison.ts"],"sourcesContent":["// Query Comparison Test\r\n// This file tests Supabase queries vs Prisma queries side-by-side\r\n// Run with: node -r ts-node/register lib/db/test-queries-comparison.ts\r\n// Or import and use in a test page\r\n\r\nimport { userQueries as supabaseUserQueries } from './queries'\r\nimport { userQueries as prismaUserQueries } from './queries-prisma'\r\nimport { userProfileQueries as supabaseProfileQueries } from './queries'\r\nimport { userProfileQueries as prismaProfileQueries } from './queries-prisma'\r\nimport { opportunityQueries as supabaseOppQueries } from './queries'\r\nimport { opportunityQueries as prismaOppQueries } from './queries-prisma'\r\n\r\ninterface ComparisonResult {\r\n  testName: string\r\n  supabaseResult: any\r\n  prismaResult: any\r\n  match: boolean\r\n  differences?: string[]\r\n}\r\n\r\n/**\r\n * Compare two results and return differences\r\n */\r\nfunction compareResults(supabase: any, prisma: any): { match: boolean; differences?: string[] } {\r\n  const differences: string[] = []\r\n\r\n  // Check if both succeeded\r\n  if (supabase.success !== prisma.success) {\r\n    differences.push(`Success mismatch: Supabase=${supabase.success}, Prisma=${prisma.success}`)\r\n    return { match: false, differences }\r\n  }\r\n\r\n  if (!supabase.success || !prisma.success) {\r\n    // Both failed - check error messages\r\n    if (supabase.error !== prisma.error) {\r\n      differences.push(`Error mismatch: Supabase=\"${supabase.error}\", Prisma=\"${prisma.error}\"`)\r\n      return { match: false, differences }\r\n    }\r\n    return { match: true } // Both failed with same error - considered a match\r\n  }\r\n\r\n  // Both succeeded - compare data\r\n  const supabaseData = supabase.data\r\n  const prismaData = prisma.data\r\n\r\n  if (Array.isArray(supabaseData) && Array.isArray(prismaData)) {\r\n    if (supabaseData.length !== prismaData.length) {\r\n      differences.push(`Array length mismatch: Supabase=${supabaseData.length}, Prisma=${prismaData.length}`)\r\n      return { match: false, differences }\r\n    }\r\n\r\n    // Compare each item (simplified - just check IDs)\r\n    supabaseData.forEach((item: any, index: number) => {\r\n      if (item.id !== prismaData[index]?.id) {\r\n        differences.push(`Item ${index} ID mismatch: Supabase=${item.id}, Prisma=${prismaData[index]?.id}`)\r\n      }\r\n    })\r\n  } else if (supabaseData && prismaData) {\r\n    // Compare objects\r\n    if (supabaseData.id !== prismaData.id) {\r\n      differences.push(`ID mismatch: Supabase=${supabaseData.id}, Prisma=${prismaData.id}`)\r\n    }\r\n  } else if (!supabaseData && !prismaData) {\r\n    // Both null - match\r\n    return { match: true }\r\n  } else {\r\n    differences.push(`Data presence mismatch: Supabase has data=${!!supabaseData}, Prisma has data=${!!prismaData}`)\r\n    return { match: false, differences }\r\n  }\r\n\r\n  return {\r\n    match: differences.length === 0,\r\n    differences: differences.length > 0 ? differences : undefined,\r\n  }\r\n}\r\n\r\n/**\r\n * Run all query comparison tests\r\n */\r\nexport async function runQueryComparisonTests(): Promise<ComparisonResult[]> {\r\n  const results: ComparisonResult[] = []\r\n\r\n  console.log('ðŸ§ª Starting Query Comparison Tests...\\n')\r\n\r\n  // Test 1: Get All Users\r\n  try {\r\n    console.log('Test 1: Getting all users...')\r\n    const supabaseResult = await supabaseUserQueries.getAll()\r\n    const prismaResult = await prismaUserQueries.getAll()\r\n    const comparison = compareResults(supabaseResult, prismaResult)\r\n\r\n    results.push({\r\n      testName: 'Get All Users',\r\n      supabaseResult,\r\n      prismaResult,\r\n      ...comparison,\r\n    })\r\n\r\n    console.log(`  âœ… Supabase: ${supabaseResult.success ? 'Success' : 'Failed'}`)\r\n    console.log(`  âœ… Prisma: ${prismaResult.success ? 'Success' : 'Failed'}`)\r\n    console.log(`  ${comparison.match ? 'âœ…' : 'âŒ'} Results match: ${comparison.match}\\n`)\r\n  } catch (error: any) {\r\n    console.error('  âŒ Test 1 failed:', error.message)\r\n    results.push({\r\n      testName: 'Get All Users',\r\n      supabaseResult: { success: false, error: error.message },\r\n      prismaResult: { success: false, error: error.message },\r\n      match: false,\r\n      differences: [error.message],\r\n    })\r\n  }\r\n\r\n  // Test 2: Get User by ID (using first user from Test 1)\r\n  try {\r\n    const allUsersResult = await prismaUserQueries.getAll()\r\n    if (allUsersResult.success && allUsersResult.data && allUsersResult.data.length > 0) {\r\n      const testUserId = allUsersResult.data[0].id\r\n      console.log(`Test 2: Getting user by ID (${testUserId})...`)\r\n\r\n      const supabaseResult = await supabaseUserQueries.getById(testUserId)\r\n      const prismaResult = await prismaUserQueries.getById(testUserId)\r\n      const comparison = compareResults(supabaseResult, prismaResult)\r\n\r\n      results.push({\r\n        testName: 'Get User by ID',\r\n        supabaseResult,\r\n        prismaResult,\r\n        ...comparison,\r\n      })\r\n\r\n      console.log(`  âœ… Supabase: ${supabaseResult.success ? 'Success' : 'Failed'}`)\r\n      console.log(`  âœ… Prisma: ${prismaResult.success ? 'Success' : 'Failed'}`)\r\n      console.log(`  ${comparison.match ? 'âœ…' : 'âŒ'} Results match: ${comparison.match}\\n`)\r\n    } else {\r\n      console.log('  âš ï¸  Skipped: No users found for testing\\n')\r\n    }\r\n  } catch (error: any) {\r\n    console.error('  âŒ Test 2 failed:', error.message)\r\n  }\r\n\r\n  // Test 3: Get User by Email\r\n  try {\r\n    const allUsersResult = await prismaUserQueries.getAll()\r\n    if (allUsersResult.success && allUsersResult.data && allUsersResult.data.length > 0) {\r\n      const testEmail = allUsersResult.data[0].email\r\n      console.log(`Test 3: Getting user by email (${testEmail})...`)\r\n\r\n      const supabaseResult = await supabaseUserQueries.getByEmail(testEmail)\r\n      const prismaResult = await prismaUserQueries.getByEmail(testEmail)\r\n      const comparison = compareResults(supabaseResult, prismaResult)\r\n\r\n      results.push({\r\n        testName: 'Get User by Email',\r\n        supabaseResult,\r\n        prismaResult,\r\n        ...comparison,\r\n      })\r\n\r\n      console.log(`  âœ… Supabase: ${supabaseResult.success ? 'Success' : 'Failed'}`)\r\n      console.log(`  âœ… Prisma: ${prismaResult.success ? 'Success' : 'Failed'}`)\r\n      console.log(`  ${comparison.match ? 'âœ…' : 'âŒ'} Results match: ${comparison.match}\\n`)\r\n    } else {\r\n      console.log('  âš ï¸  Skipped: No users found for testing\\n')\r\n    }\r\n  } catch (error: any) {\r\n    console.error('  âŒ Test 3 failed:', error.message)\r\n  }\r\n\r\n  // Test 4: Get All Opportunities\r\n  try {\r\n    console.log('Test 4: Getting all opportunities...')\r\n    const supabaseResult = await supabaseOppQueries.getAll()\r\n    const prismaResult = await prismaOppQueries.getAll()\r\n    const comparison = compareResults(supabaseResult, prismaResult)\r\n\r\n    results.push({\r\n      testName: 'Get All Opportunities',\r\n      supabaseResult,\r\n      prismaResult,\r\n      ...comparison,\r\n    })\r\n\r\n    console.log(`  âœ… Supabase: ${supabaseResult.success ? 'Success' : 'Failed'}`)\r\n    console.log(`  âœ… Prisma: ${prismaResult.success ? 'Success' : 'Failed'}`)\r\n    console.log(`  ${comparison.match ? 'âœ…' : 'âŒ'} Results match: ${comparison.match}\\n`)\r\n  } catch (error: any) {\r\n    console.error('  âŒ Test 4 failed:', error.message)\r\n  }\r\n\r\n  // Test 5: Get Active Opportunities\r\n  try {\r\n    console.log('Test 5: Getting active opportunities...')\r\n    const supabaseResult = await supabaseOppQueries.getActive()\r\n    const prismaResult = await prismaOppQueries.getActive()\r\n    const comparison = compareResults(supabaseResult, prismaResult)\r\n\r\n    results.push({\r\n      testName: 'Get Active Opportunities',\r\n      supabaseResult,\r\n      prismaResult,\r\n      ...comparison,\r\n    })\r\n\r\n    console.log(`  âœ… Supabase: ${supabaseResult.success ? 'Success' : 'Failed'}`)\r\n    console.log(`  âœ… Prisma: ${prismaResult.success ? 'Success' : 'Failed'}`)\r\n    console.log(`  ${comparison.match ? 'âœ…' : 'âŒ'} Results match: ${comparison.match}\\n`)\r\n  } catch (error: any) {\r\n    console.error('  âŒ Test 5 failed:', error.message)\r\n  }\r\n\r\n  // Test 6: Get User Profile (if user exists)\r\n  try {\r\n    const allUsersResult = await prismaUserQueries.getAll()\r\n    if (allUsersResult.success && allUsersResult.data && allUsersResult.data.length > 0) {\r\n      const testUserId = allUsersResult.data[0].id\r\n      console.log(`Test 6: Getting user profile for user ${testUserId}...`)\r\n\r\n      const supabaseResult = await supabaseProfileQueries.getByUserId(testUserId)\r\n      const prismaResult = await prismaProfileQueries.getByUserId(testUserId)\r\n      const comparison = compareResults(supabaseResult, prismaResult)\r\n\r\n      results.push({\r\n        testName: 'Get User Profile',\r\n        supabaseResult,\r\n        prismaResult,\r\n        ...comparison,\r\n      })\r\n\r\n      console.log(`  âœ… Supabase: ${supabaseResult.success ? 'Success' : 'Failed'}`)\r\n      console.log(`  âœ… Prisma: ${prismaResult.success ? 'Success' : 'Failed'}`)\r\n      console.log(`  ${comparison.match ? 'âœ…' : 'âŒ'} Results match: ${comparison.match}\\n`)\r\n    } else {\r\n      console.log('  âš ï¸  Skipped: No users found for testing\\n')\r\n    }\r\n  } catch (error: any) {\r\n    console.error('  âŒ Test 6 failed:', error.message)\r\n  }\r\n\r\n  return results\r\n}\r\n\r\n/**\r\n * Print summary of all test results\r\n */\r\nexport function printTestSummary(results: ComparisonResult[]) {\r\n  console.log('\\n' + '='.repeat(60))\r\n  console.log('ðŸ“Š TEST SUMMARY')\r\n  console.log('='.repeat(60) + '\\n')\r\n\r\n  const passed = results.filter(r => r.match).length\r\n  const failed = results.filter(r => !r.match).length\r\n  const total = results.length\r\n\r\n  console.log(`Total Tests: ${total}`)\r\n  console.log(`âœ… Passed: ${passed}`)\r\n  console.log(`âŒ Failed: ${failed}`)\r\n  console.log(`Success Rate: ${((passed / total) * 100).toFixed(1)}%\\n`)\r\n\r\n  if (failed > 0) {\r\n    console.log('âŒ FAILED TESTS:')\r\n    console.log('-'.repeat(60))\r\n    results\r\n      .filter(r => !r.match)\r\n      .forEach(result => {\r\n        console.log(`\\n${result.testName}:`)\r\n        if (result.differences) {\r\n          result.differences.forEach(diff => console.log(`  - ${diff}`))\r\n        }\r\n      })\r\n    console.log('\\n')\r\n  }\r\n\r\n  console.log('='.repeat(60) + '\\n')\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1284, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/liqui/OneDrive/Desktop/ai-funding-platform/app/api/test/query-comparison/route.ts"],"sourcesContent":["// API Route to test query comparison\r\n// GET /api/test/query-comparison\r\n// This runs Supabase vs Prisma query comparisons\r\n\r\nimport { NextResponse } from 'next/server'\r\nimport { runQueryComparisonTests, printTestSummary } from '@/lib/db/test-queries-comparison'\r\n\r\nexport async function GET() {\r\n  try {\r\n    console.log('Starting query comparison tests...')\r\n    \r\n    const results = await runQueryComparisonTests()\r\n    printTestSummary(results)\r\n\r\n    const passed = results.filter(r => r.match).length\r\n    const failed = results.filter(r => !r.match).length\r\n    const total = results.length\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      summary: {\r\n        total,\r\n        passed,\r\n        failed,\r\n        successRate: ((passed / total) * 100).toFixed(1) + '%',\r\n      },\r\n      results: results.map(r => ({\r\n        testName: r.testName,\r\n        match: r.match,\r\n        differences: r.differences,\r\n        supabaseSuccess: r.supabaseResult.success,\r\n        prismaSuccess: r.prismaResult.success,\r\n        supabaseError: r.supabaseResult.error,\r\n        prismaError: r.prismaResult.error,\r\n      })),\r\n    })\r\n  } catch (error: any) {\r\n    console.error('Query comparison test failed:', error)\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: error.message || 'Failed to run comparison tests',\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"AAAA,qCAAqC;AACrC,iCAAiC;AACjC,iDAAiD;;;;;AAEjD;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,MAAM,UAAU,MAAM,IAAA,uKAAuB;QAC7C,IAAA,gKAAgB,EAAC;QAEjB,MAAM,SAAS,QAAQ,MAAM,CAAC,CAAA,IAAK,EAAE,KAAK,EAAE,MAAM;QAClD,MAAM,SAAS,QAAQ,MAAM,CAAC,CAAA,IAAK,CAAC,EAAE,KAAK,EAAE,MAAM;QACnD,MAAM,QAAQ,QAAQ,MAAM;QAE5B,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,SAAS;gBACP;gBACA;gBACA;gBACA,aAAa,CAAC,AAAC,SAAS,QAAS,GAAG,EAAE,OAAO,CAAC,KAAK;YACrD;YACA,SAAS,QAAQ,GAAG,CAAC,CAAA,IAAK,CAAC;oBACzB,UAAU,EAAE,QAAQ;oBACpB,OAAO,EAAE,KAAK;oBACd,aAAa,EAAE,WAAW;oBAC1B,iBAAiB,EAAE,cAAc,CAAC,OAAO;oBACzC,eAAe,EAAE,YAAY,CAAC,OAAO;oBACrC,eAAe,EAAE,cAAc,CAAC,KAAK;oBACrC,aAAa,EAAE,YAAY,CAAC,KAAK;gBACnC,CAAC;QACH;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,OAAO,+QAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,MAAM,OAAO,IAAI;QAC1B,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}